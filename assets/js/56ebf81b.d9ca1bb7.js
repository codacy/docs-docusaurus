"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[1748],{11926(e,i,o){o.d(i,{Ay:()=>a,RM:()=>r});var t=o(74848),n=o(28453);const r=[];function s(e){const i={a:"a",admonition:"admonition",p:"p",...(0,n.R)(),...e.components};return(0,t.jsx)(i.admonition,{type:"caution",children:(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.a,{href:"/codacy-api/using-the-codacy-api#using-pagination",children:"Learn how to use pagination"})," to ensure that you process all results returned by the API."]})})}function a(e={}){const{wrapper:i}={...(0,n.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(s,{...e})}):s(e)}},28453(e,i,o){o.d(i,{R:()=>s,x:()=>a});var t=o(96540);const n={},r=t.createContext(n);function s(e){const i=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),t.createElement(r.Provider,{value:i},e.children)}},88627(e,i,o){o.r(i),o.d(i,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"codacy-api/examples/adding-repositories-to-codacy-programmatically","title":"Adding repositories to Codacy programmatically","description":"Example of how to add multiple repositories programmatically using Codacy\'s API v3 endpoint addRepository.","source":"@site/docs/codacy-api/examples/adding-repositories-to-codacy-programmatically.mdx","sourceDirName":"codacy-api/examples","slug":"/codacy-api/examples/adding-repositories-to-codacy-programmatically","permalink":"/docs-docusaurus/codacy-api/examples/adding-repositories-to-codacy-programmatically","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Adding repositories to Codacy programmatically","description":"Example of how to add multiple repositories programmatically using Codacy\'s API v3 endpoint addRepository."},"sidebar":"documentationSidebar","previous":{"title":"Adding people to Codacy programmatically","permalink":"/docs-docusaurus/codacy-api/examples/adding-people-to-codacy-programmatically"},"next":{"title":"Obtaining current issues in repositories","permalink":"/docs-docusaurus/codacy-api/examples/obtaining-current-issues-in-repositories"}}');var n=o(74848),r=o(28453),s=o(11926);const a={title:"Adding repositories to Codacy programmatically",description:"Example of how to add multiple repositories programmatically using Codacy's API v3 endpoint addRepository."},d=void 0,c={},l=[{value:"Example: Adding all repositories in a GitHub organization",id:"example-adding-all-repositories-in-a-github-organization",level:2},...s.RM];function p(e){const i={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.p,{children:"There are scenarios where manually adding Git repositories on the Codacy UI is inconvenient or time-consuming. For example:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"You want to add all new repositories to Codacy when they're created on the Git provider"}),"\n",(0,n.jsx)(i.li,{children:"You're adding many repositories to Codacy, such as when initially adding all repositories in your Git provider organization"}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["To add repositories programmatically, use the Codacy API v3 endpoint ",(0,n.jsx)(i.a,{href:"https://app.codacy.com/api/api-docs#addrepository",children:(0,n.jsx)("span",{class:"skip-vale",children:"addRepository"})})," by performing an HTTP POST request to ",(0,n.jsx)(i.code,{children:"/repositories"}),", specifying the Git provider and the full path of the repository in the body of the request:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'curl -X POST https://app.codacy.com/api/v3/repositories \\\n  -H \'Content-Type: application/json\' \\\n  -H \'api-token: <API_KEY>\' \\\n  -d \'{"provider":"<GIT_PROVIDER>", "repositoryFullPath":"<REPOSITORY_FULL_PATH>"}\'\n'})}),"\n",(0,n.jsx)(i.p,{children:"Substitute the placeholders with your own values:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"API_KEY:"})," ",(0,n.jsx)(i.a,{href:"../api-tokens.md#account-api-tokens",children:"Account API token"})," used to authenticate on the Codacy API."]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"GIT_PROVIDER:"})," Git provider hosting of the repository, using one of the values in the table below. For example, ",(0,n.jsx)(i.code,{children:"gh"})," for GitHub Cloud."]}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Value"}),(0,n.jsx)(i.th,{children:"Git provider"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"gh"})}),(0,n.jsx)(i.td,{children:"GitHub Cloud"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"ghe"})}),(0,n.jsx)(i.td,{children:"GitHub Enterprise"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"gl"})}),(0,n.jsx)(i.td,{children:"GitLab Cloud"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"gle"})}),(0,n.jsx)(i.td,{children:"GitLab Enterprise"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"bb"})}),(0,n.jsx)(i.td,{children:"Bitbucket Cloud"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"bbe"})}),(0,n.jsx)(i.td,{children:"Bitbucket Server"})]})]})]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"REPOSITORY_FULL_PATH:"})," Name of the organization and repository on the Git provider, using the format ",(0,n.jsx)(i.code,{children:"<organization>/<repository>"}),". For example, ",(0,n.jsx)(i.code,{children:"codacy/docs"}),". You must have admin permissions over the repository on the Git provider."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.admonition,{type:"note",children:(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"If you're using GitLab"})," you must specify the full group path and the repository using the format ",(0,n.jsx)(i.code,{children:"<group>/<subgroup-1>/.../<subgroup-N>/<repository>"}),"."]})}),"\n",(0,n.jsx)(i.h2,{id:"example-adding-all-repositories-in-a-github-organization",children:"Example: Adding all repositories in a GitHub organization"}),"\n",(0,n.jsx)(i.p,{children:"We provide an example Bash script that adds all repositories in a GitHub Cloud organization to Codacy. We suggest that you adapt the script to your specific scenario."}),"\n",(0,n.jsxs)(i.admonition,{type:"caution",children:[(0,n.jsx)(i.p,{children:"Since Codacy automatically analyzes new repositories, adding many repositories in a short time can cause delays in the analysis of other repositories depending on the size of the repositories, the sizing of the infrastructure, and the concurrent analysis configuration. For example:"}),(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Repositories added"}),(0,n.jsx)(i.th,{children:"Expected delay"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"1 to 10"}),(0,n.jsx)(i.td,{children:"Small"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"11 to 100"}),(0,n.jsx)(i.td,{children:"Considerable"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"More than 100"}),(0,n.jsx)(i.td,{children:"Extreme"})]})]})]}),(0,n.jsx)(i.p,{children:"To avoid these delays, add repositories in small batches or space out adding new repositories over time."})]}),"\n",(0,n.jsx)(i.p,{children:"The example script:"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:["Defines a GitHub ",(0,n.jsx)(i.a,{href:"https://github.com/settings/tokens",children:"personal access token"}),", the GitHub organization name, and the ",(0,n.jsx)(i.a,{href:"../api-tokens.md#account-api-tokens",children:"account API token"})," used to authenticate on the Codacy API."]}),"\n",(0,n.jsxs)(i.li,{children:["Calls the GitHub API to ",(0,n.jsx)(i.a,{href:"https://docs.github.com/en/rest/repos/repos#list-organization-repositories",children:"obtain the list of all repositories"})," in the defined organization."]}),"\n",(0,n.jsxs)(i.li,{children:["Uses ",(0,n.jsx)(i.a,{href:"https://github.com/stedolan/jq",children:"jq"})," to return the value of ",(0,n.jsx)(i.code,{children:"full_name"})," for each repository obtained in the JSON response. The ",(0,n.jsx)(i.code,{children:"full_name"})," already includes the organization and repository names using the format ",(0,n.jsx)(i.code,{children:"<organization>/<repository>"}),"."]}),"\n",(0,n.jsxs)(i.li,{children:["For each repository, calls the endpoint ",(0,n.jsx)(i.a,{href:"https://app.codacy.com/api/api-docs#addrepository",children:(0,n.jsx)("span",{class:"skip-vale",children:"addRepository"})})," to add a new repository specifying ",(0,n.jsx)(i.code,{children:"gh"})," as the Git provider and the value of ",(0,n.jsx)(i.code,{children:"full_name"})," as the full path of the repository."]}),"\n",(0,n.jsx)(i.li,{children:"Checks the HTTP status code obtained in the response and performs basic error handling."}),"\n",(0,n.jsx)(i.li,{children:"Pauses a few seconds between requests to the Codacy API to avoid rate limiting."}),"\n"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:'#!/bin/bash\n\nGITHUB_AUTH_TOKEN="<your GitHub personal access token>"\nGITHUB_ORG_NAME="<your GitHub organization name>"\nCODACY_API_TOKEN="<your account API token>"\n\nprintf "Obtaining all repositories in the $GITHUB_ORG_NAME organization\\n"\nfor repo in $(curl -s https://api.github.com/orgs/$GITHUB_ORG_NAME/repos -H "Authorization: Bearer $GITHUB_AUTH_TOKEN" | jq -r \'.[] | .full_name\'); do\n  printf "Adding $repo to Codacy\\n"\n  http_status=$(curl -X POST https://app.codacy.com/api/v3/repositories \\\n                     -H "Content-Type: application/json" \\\n                     -H "api-token: $CODACY_API_TOKEN" \\\n                     -d \'{"provider":"gh", "repositoryFullPath":"\'$repo\'"}\' \\\n                     -sSo /dev/null -w "%{http_code}")\n  case "$http_status" in\n    200) printf "$repo added successfully\\n"\n         ;;\n    401) printf "Error: 401 Unauthorized, check the Codacy API token\\n"\n         break\n         ;;\n    409) printf "Error: 409 Conflict, $repo is already added to Codacy\\n"\n         ;;\n      *) printf "Error: $http_status HTTP status code\\n"\n         break\n         ;;\n  esac\n  sleep 60 # Pause between repositories\ndone\n'})}),"\n",(0,n.jsx)(s.Ay,{}),"\n",(0,n.jsx)(i.admonition,{type:"caution",children:(0,n.jsxs)(i.p,{children:["Besides this, the script doesn't consider paginated results obtained from the GitHub API. ",(0,n.jsx)(i.a,{href:"https://docs.github.com/en/rest/using-the-rest-api/using-pagination-in-the-rest-api",children:"Learn how to use pagination on the GitHub API"})," to ensure that you obtain all the repositories in your organization."]})})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}}}]);